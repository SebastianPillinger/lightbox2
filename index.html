<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bildergalerie mit Swipe-Effekt</title>
    <style>
        /* [Vorherige CSS-Stile bleiben gleich bis zum .lightbox-content] */
        
        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 80vh;
            width: 100%;
            overflow: hidden;
        }
        
        .lightbox-slider {
            display: flex;
            height: 100%;
            width: 100%;
            transition: transform 0.4s ease;
        }
        
        .lightbox-slide {
            min-width: 100%;
            position: relative;
        }
        
        .lightbox-slide img {
            max-width: 100%;
            max-height: 80vh;
            width: auto;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        /* [Rest der vorherigen CSS-Stile bleibt gleich] */
    </style>
</head>
<body>
    <!-- [Der gesamte HTML-Code bleibt gleich bis zum Script-Tag] -->
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const lightbox = document.getElementById('lightbox');
            const lightboxSlider = document.createElement('div');
            lightboxSlider.className = 'lightbox-slider';
            document.querySelector('.lightbox-content').prepend(lightboxSlider);
            
            const lightboxCaption = document.getElementById('lightbox-caption');
            const galleryItems = document.querySelectorAll('.gallery-item');
            const closeBtn = document.querySelector('.close-btn');
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            
            let currentIndex = 0;
            let touchStartX = 0;
            let isDragging = false;
            let startPos = 0;
            let currentTranslate = 0;
            let prevTranslate = 0;
            let animationID = 0;
            
            // Slider vorbereiten
            function initSlider() {
                lightboxSlider.innerHTML = '';
                galleryItems.forEach((item, index) => {
                    const slide = document.createElement('div');
                    slide.className = 'lightbox-slide';
                    const img = item.querySelector('img').cloneNode();
                    slide.appendChild(img);
                    lightboxSlider.appendChild(slide);
                });
                updateSliderPosition();
            }
            
            // Slider Position aktualisieren
            function updateSliderPosition() {
                lightboxSlider.style.transform = `translateX(-${currentIndex * 100}%)`;
                updateCaption();
            }
            
            // Bildbeschreibung aktualisieren
            function updateCaption() {
                const img = galleryItems[currentIndex].querySelector('img');
                lightboxCaption.textContent = img.alt || `Bild ${currentIndex + 1}`;
            }
            
            // Lightbox öffnen
            function openLightbox(index) {
                currentIndex = index;
                initSlider();
                lightbox.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            // Lightbox schließen
            function closeLightbox() {
                lightbox.classList.remove('active');
                document.body.style.overflow = '';
            }
            
            // Zum vorherigen Bild
            function prevImage() {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateSliderPosition();
                }
            }
            
            // Zum nächsten Bild
            function nextImage() {
                if (currentIndex < galleryItems.length - 1) {
                    currentIndex++;
                    updateSliderPosition();
                }
            }
            
            // Touch Events für Swipe-Gesten
            function startDrag(e) {
                if (e.type === 'touchstart') {
                    touchStartX = e.touches[0].clientX;
                } else {
                    touchStartX = e.clientX;
                    e.preventDefault();
                }
                isDragging = true;
                startPos = touchStartX;
                prevTranslate = currentTranslate;
                animationID = requestAnimationFrame(animation);
                lightboxSlider.style.transition = 'none';
            }
            
            function duringDrag(e) {
                if (!isDragging) return;
                let currentX;
                if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX;
                } else {
                    currentX = e.clientX;
                }
                currentTranslate = prevTranslate + currentX - startPos;
                lightboxSlider.style.transform = `translateX(calc(-${currentIndex * 100}% + ${currentTranslate}px))`;
            }
            
            function endDrag(e) {
                if (!isDragging) return;
                isDragging = false;
                cancelAnimationFrame(animationID);
                
                let movedBy = currentTranslate;
                lightboxSlider.style.transition = 'transform 0.4s ease';
                
                // Entscheiden ob zum nächsten/vorherigen Bild gewechselt wird
                if (movedBy < -50 && currentIndex < galleryItems.length - 1) {
                    currentIndex++;
                } else if (movedBy > 50 && currentIndex > 0) {
                    currentIndex--;
                }
                
                updateSliderPosition();
            }
            
            function animation() {
                lightboxSlider.style.transform = `translateX(calc(-${currentIndex * 100}% + ${currentTranslate}px))`;
                animationID = requestAnimationFrame(animation);
            }
            
            // Event Listener
            galleryItems.forEach((item, index) => {
                item.addEventListener('click', () => openLightbox(index));
                item.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        openLightbox(index);
                    }
                });
            });
            
            closeBtn.addEventListener('click', closeLightbox);
            prevBtn.addEventListener('click', prevImage);
            nextBtn.addEventListener('click', nextImage);
            
            // Mouse und Touch Events
            lightboxSlider.addEventListener('touchstart', startDrag, { passive: false });
            lightboxSlider.addEventListener('touchmove', duringDrag, { passive: false });
            lightboxSlider.addEventListener('touchend', endDrag);
            
            lightboxSlider.addEventListener('mousedown', startDrag);
            lightboxSlider.addEventListener('mousemove', duringDrag);
            lightboxSlider.addEventListener('mouseup', endDrag);
            lightboxSlider.addEventListener('mouseleave', endDrag);
            
            // Tastatursteuerung
            document.addEventListener('keydown', (e) => {
                if (!lightbox.classList.contains('active')) return;
                
                switch (e.key) {
                    case 'Escape':
                        closeLightbox();
                        break;
                    case 'ArrowLeft':
                        prevImage();
                        break;
                    case 'ArrowRight':
                        nextImage();
                        break;
                }
            });
        });
    </script>
</body>
</html>
